# üéØ Task: Implement Lead Capture with Prisma & Neon

**Objective:** Persist student contact information (WhatsApp numbers) and project interests into a Neon PostgreSQL database using Prisma, enabling manual sales follow-up.
**Priority:** High
**Scope:** 
- Database setup with Prisma + Neon
- Lead schema design
- Server actions for saving leads
- AI Sales Consultant (Jay) integration to trigger lead capture
- Exclusion: External notification system (Discord/Telegram) is for a separate task.

---

## üìã Requirements

### Functional Requirements
- **[REQ-001]** Capture WhatsApp number when Jay requests it in the chat.
- **[REQ-002]** Capture the "Topic" and "Twist" currently being discussed.
- **[REQ-003]** Link the lead to a WorkOS user ID if the user is logged in.
- **[REQ-004]** Support anonymous leads (capturing details before signup).

### Technical Requirements
- **[TECH-001]** Neon DB connection via pooled URL.
- **[TECH-002]** Prisma schema with `Lead` model.
- **[TECH-003]** Zod validation for phone numbers and input data.
- **[TECH-004]** Server action `saveLeadAction` in `src/features/bot/actions/chat.ts`.

---

## üèóÔ∏è Implementation Plan

### Phase 1: Setup
- [ ] Install `@prisma/client` and `prisma` dev dependency.
- [ ] Initialize Prisma and configure the Neon connection in `.env.local`.
- [ ] Define `Lead` model in `prisma/schema.prisma`.

### Phase 2: Core Implementation
- [ ] Run `npx prisma db push` to sync schema with Neon.
- [ ] Create `saveLeadAction` to handle lead persistence.
- [ ] Update `ChatInterface` or `useChatFlow` to call `saveLeadAction` when the user provides their number.

### Phase 3: AI Integration
- [ ] Ensure the AI Sales Consultant prompt encourages number sharing at the right time.
- [ ] Update `confirmTopic` tool (if applicable) to optionally include lead capture.

### Phase 4: Testing & Documentation
- [ ] Verify lead persistence in the Neon console.
- [ ] Update `docs/features/FR-003_Lead_Capture.md` with implementation details.

---

## üìÅ Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `prisma/schema.prisma` | Create | Define lead data model. |
| `src/features/bot/actions/chat.ts` | Modify | Add `saveLeadAction`. |
| `src/features/bot/hooks/useChatFlow.ts` | Modify | Integrate lead capture logic. |
| `.env.local` | Modify | Add `DATABASE_URL` and `DIRECT_URL`. |

---

## ‚úÖ Success Criteria

### Code Quality
- [ ] Type-safe database queries via Prisma.
- [ ] Input validation using Zod.
- [ ] Clean separation of database logic from UI components.

### Functionality
- [ ] WhatsApp numbers are saved correctly in Neon.
- [ ] Leads are associated with the correct project topic/twist.
- [ ] No 500 errors if the DB is unreachable (graceful failure).

---

## üîó Dependencies

**Depends on:**
- Neon Database project (provided by user)
- Prisma ORM

**Used by:**
- `ChatInterface.tsx`
- Sales follow-up processes (manual)

---

## üöÄ Getting Started

1. Read this task prompt completely.
2. Ensure you have the Neon Database connection strings from the user.
3. Begin with Phase 1: Setup.
4. Provide progress updates after each phase.

---

*Generated by /spawn_task workflow*
