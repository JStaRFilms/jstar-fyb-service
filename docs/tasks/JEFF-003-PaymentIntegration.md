# üéØ Task: [JEFF-003] Payment Integration

**Objective:** Replace fake "Unlock" with Paystack payment flow
**Priority:** High
**Scope:** Paystack checkout, webhook, payment verification

---

## üìã Requirements

### Functional Requirements
- **[REQ-001]** "Unlock Now" redirects to Paystack checkout
- **[REQ-002]** Webhook confirms payment and unlocks project
- **[REQ-003]** Show payment confirmation UI
- **[REQ-004]** Handle failed/cancelled payments gracefully

### Technical Requirements
- **[TECH-001]** Use Paystack Popup or Redirect
- **[TECH-002]** Verify webhook signature
- **[TECH-003]** Store transaction reference in DB
- **[TECH-004]** Idempotent unlock (prevent double-unlocking)

---

## üèóÔ∏è Implementation Plan

### Phase 1: Schema & Config
- [ ] Add `Payment` model: `{ id, projectId, amount, reference, status }`
- [ ] Add `PAYSTACK_SECRET_KEY` and `PAYSTACK_PUBLIC_KEY` to env

### Phase 2: Checkout Flow
- [ ] Create `/api/payments/initialize` route
- [ ] Return Paystack authorization URL
- [ ] Update `PricingOverlay` to call initialize API

### Phase 3: Webhook
- [ ] Create `/api/payments/webhook` route
- [ ] Verify signature, update payment status
- [ ] Set `isUnlocked = true` on project

### Phase 4: Confirmation UI
- [ ] Show success state after redirect back
- [ ] Handle callback URL params

---

## üìÅ Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `prisma/schema.prisma` | Modify | Add Payment model |
| `src/app/api/payments/initialize/route.ts` | Create | Start checkout |
| `src/app/api/payments/webhook/route.ts` | Create | Handle Paystack events |
| `src/features/builder/components/PricingOverlay.tsx` | Modify | Real payment button |

---

## ‚úÖ Success Criteria

- [ ] Customer can pay with card/bank
- [ ] Project unlocks only after verified payment
- [ ] Webhook handles all payment states

---

## üîß Environment Variables

```env
PAYSTACK_SECRET_KEY=sk_test_xxx
PAYSTACK_PUBLIC_KEY=pk_test_xxx
```

---

*Generated by /spawn_task workflow*
