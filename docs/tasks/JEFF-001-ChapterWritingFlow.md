# ğŸ¯ Task: [JEFF-001] Chapter Writing Flow

**Objective:** Enable AI-powered chapter drafting with customer review/approval workflow
**Priority:** High
**Scope:** Core value proposition - customers pay for this feature

---

## ğŸ“‹ Requirements

### Functional Requirements
- **[REQ-001]** After status = `RESEARCH_COMPLETE`, enable "Generate Chapter" for each outline item
- **[REQ-002]** AI generates chapter draft using extracted PDF metadata + outline
- **[REQ-003]** Customer can review, request edits, or approve each chapter
- **[REQ-004]** Download final document as DOCX/PDF when all chapters approved

### Technical Requirements
- **[TECH-001]** Use Gemini for chapter generation with citations
- **[TECH-002]** Store chapter drafts in DB with version history
- **[TECH-003]** Markdown editor for review/edits

---

## ğŸ—ï¸ Implementation Plan

### Phase 1: Schema & API
- [ ] Add `Chapter` model: `{ id, projectId, title, content, status, version }`
- [ ] Create `/api/chapters/generate` route
- [ ] Create `/api/chapters/[id]/approve` route

### Phase 2: Admin Chapter Generation
- [ ] Add "Generate Chapters" button in admin detail
- [ ] Show generation progress per chapter
- [ ] Display generated content with edit capability

### Phase 3: Customer Review UI
- [ ] Create `ChapterReview.tsx` component
- [ ] Add chapter approval workflow (Approve / Request Edits)
- [ ] Show overall progress (3/5 chapters approved)

### Phase 4: Export
- [ ] Compile approved chapters into final document
- [ ] Generate DOCX using `docx` library
- [ ] Add download button

---

## ğŸ“ Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `prisma/schema.prisma` | Modify | Add Chapter model |
| `src/app/api/chapters/generate/route.ts` | Create | AI chapter generation |
| `src/app/api/chapters/[id]/approve/route.ts` | Create | Approval endpoint |
| `src/features/builder/components/ChapterReview.tsx` | Create | Customer review UI |
| `src/features/admin/components/ChapterGenerator.tsx` | Create | Admin generation UI |

---

## âœ… Success Criteria

- [ ] Admin can generate chapters from research
- [ ] Customer can review and approve chapters
- [ ] Final document downloadable as DOCX
- [ ] Citations from extracted PDFs included

---

## ğŸ”— Dependencies

**Depends on:**
- Gemini PDF extraction (completed)
- Project outline (completed)

**Related files:**
- `src/app/api/documents/[id]/extract/route.ts`
- `src/features/builder/store/useBuilderStore.ts`

---

*Generated by /spawn_task workflow*
