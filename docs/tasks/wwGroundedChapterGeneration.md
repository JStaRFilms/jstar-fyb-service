# ğŸ¯ Task: Grounded Chapter Generation (Phase 2 Gap)

**Objective:** Refactor chapter generation to use uploaded research documents via Gemini FileSearch.
**Priority:** High (Phase 2 completion)
**Scope:** api/generate/chapter, citations, grounding

---

## ğŸ“‹ The Gap

Currently `api/generate/chapter/route.ts`:
- Uses `groq('llama-3.3-70b-versatile')` 
- Uses `BuilderAiService` (no RAG)
- **Ignores uploaded research documents**

---

## ğŸ“‹ Requirements

**[REQ-001]** Use Gemini FileSearch for generation
- If `project.fileSearchStoreId` exists â†’ use `GeminiFileSearchService.generateWithGrounding()`
- Else â†’ fallback to current flow

**[REQ-002]** Generate citations
- Parse grounding chunks from Gemini response
- Format as in-text APA citations
- Store source references

**[REQ-003]** Update docs
- Mark Phase 2 as [COMPLETE] in `DIY_Writing_Workflow.md`

---

## ğŸ—ï¸ Implementation

```typescript
// In route.ts - pseudocode
if (project.fileSearchStoreId) {
  // Use Gemini with grounding
  const result = await GeminiFileSearchService.generateWithGrounding(
    chapterPrompt,
    [project.fileSearchStoreId]
  );
  // Parse citations from result.groundingChunks
} else {
  // Fallback to existing Llama flow
}
```

---

*Generated by /spawn_task workflow*
