# ğŸ¯ Task: [JEFF-002] Real-Time Chat

**Objective:** Add real-time message updates between customer and admin
**Priority:** Medium
**Scope:** Chat polling or WebSocket, unread badges

---

## ğŸ“‹ Requirements

### Functional Requirements
- **[REQ-001]** Messages appear without page refresh
- **[REQ-002]** Unread message count badge on chat button
- **[REQ-003]** "Typing..." indicator (optional)
- **[REQ-004]** Sound notification for new messages (optional)

### Technical Requirements
- **[TECH-001]** Use polling (every 5s) or Pusher/Ably WebSocket
- **[TECH-002]** Efficient query - only fetch new messages since last timestamp
- **[TECH-003]** Mark messages as read when chat is open

---

## ğŸ—ï¸ Implementation Plan

### Phase 1: Polling Approach
- [ ] Add `lastReadAt` field to track read status
- [ ] Modify `/api/projects/[id]/messages` to accept `since` param
- [ ] Add `useInterval` hook for polling in `CustomerChat.tsx`

### Phase 2: Unread Badge
- [ ] Count unread messages per project
- [ ] Show badge on chat button
- [ ] Clear badge when chat opened

### Phase 3: Admin Real-Time (Optional)
- [ ] Add polling to `AdminProjectDetail.tsx`
- [ ] Show "New message" toast

---

## ğŸ“ Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `src/features/builder/components/CustomerChat.tsx` | Modify | Add polling |
| `src/features/admin/components/AdminProjectDetail.tsx` | Modify | Add polling |
| `src/app/api/projects/[id]/messages/route.ts` | Modify | Add `since` filter |

---

## âœ… Success Criteria

- [ ] Messages update in real-time (< 5s delay)
- [ ] Unread badge shows correct count
- [ ] No performance issues from polling

---

*Generated by /spawn_task workflow*
